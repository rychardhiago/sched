<?phprequire_once('dbconfig.php');class profissionais{	private $conn;		public function __construct()	{		$database = new Database();		$db = $database->dbConnection();		$this->conn = $db;    }		public function runQuery($sql)	{		$stmt = $this->conn->prepare($sql);		return $stmt;	}		public function register($valor){		try{		    $nome = $valor["nome"];		    $cgc = $valor["cgc"];		    $email = $valor["email"];            $empresaid = $valor["empresaid"];            $senha = $valor["senha"];            $numsessoes = $valor["numsessoes"];            $bloqueado = $valor["bloqueado"];            $adminempresa = $valor["adminempresa"];            $admingrupo = $valor["admingrupo"];            $profissionaiid = $valor["profissionaiid"];            $descricao = $valor["descricao"];            $hralmocoini = $valor["hralmocoini"];            $hralmocofim = $valor["hralmocofim"];            $cor = $valor["cor"];            if(($cor == '') or ($cor == '#000000')){                $cor = '#008000';            }            $visao = $valor["visao"];            $new_password = password_hash($senha, PASSWORD_DEFAULT);            if($nome=="")	{                return "preencha o nome!";            }            else if($cgc=="")	{                return "preencha o cgc!";            }            else {                if ($profissionaiid <= 0) {                    $stmt = $this->conn->prepare("INSERT INTO profissionais(nome,cgc,email,empresaid,senha,numsessoes,bloqueado,adminempresa,admingrupo,descricao,hralmocoini,hralmocofim,cor,visao) VALUES(:nome, :cgc, :email, :empresaid, :senha, :numsessoes, :bloqueado, :adminempresa, :admingrupo, :descricao, :hralmocoini, :hralmocofim, :cor, :visao)");                    $stmt->bindparam(":nome", $nome);                    $stmt->bindparam(":cgc", $cgc);                    $stmt->bindparam(":email", $email);                    $stmt->bindparam(":empresaid", $empresaid);                    $stmt->bindparam(":senha", $new_password);                    $stmt->bindparam(":numsessoes", $numsessoes);                    $stmt->bindparam(":bloqueado", $bloqueado);                    $stmt->bindparam(":adminempresa", $adminempresa);                    $stmt->bindparam(":admingrupo", $admingrupo);                    $stmt->bindparam(":descricao", $descricao);                    $stmt->bindparam(":hralmocoini", $hralmocoini);                    $stmt->bindparam(":hralmocofim", $hralmocofim);                    $stmt->bindparam(":cor", $cor);                    $stmt->bindparam(":visao", $visao);                } else {                    $stmt = $this->conn->prepare("UPDATE profissionais SET nome = :nome, cgc = :cgc , email = :email , empresaid = :empresaid, senha = :senha, numsessoes = :numsessoes, bloqueado = :bloqueado, adminempresa = :adminempresa, admingrupo = :admingrupo, descricao = :descricao, hralmocoini = :hralmocoini, hralmocofim = :hralmocofim, cor = :cor, visao = :visao  WHERE profissionaiid = :profissionaiid");                    $stmt->bindparam(":nome", $nome);                    $stmt->bindparam(":cgc", $cgc);                    $stmt->bindparam(":email", $email);                    $stmt->bindparam(":empresaid", $empresaid);                    $stmt->bindparam(":senha", $new_password);                    $stmt->bindparam(":numsessoes", $numsessoes);                    $stmt->bindparam(":bloqueado", $bloqueado);                    $stmt->bindparam(":adminempresa", $adminempresa);                    $stmt->bindparam(":admingrupo", $admingrupo);                    $stmt->bindparam(":profissionaiid", $profissionaiid);                    $stmt->bindparam(":descricao", $descricao);                    $stmt->bindparam(":hralmocoini", $hralmocoini);                    $stmt->bindparam(":hralmocofim", $hralmocofim);                    $stmt->bindparam(":cor", $cor);                    $stmt->bindparam(":visao", $visao);                }                $stmt->execute();                return "0";            }		}		catch(PDOException $e){			echo $e->getMessage();		}					}    public function deletar($uid){        try{            $stmt = $this->conn->prepare("UPDATE profissionais SET excluido = 'S' WHERE profissionaiid = :uid");            $stmt->bindparam(":uid", $uid);            $stmt->execute();            return $stmt;        }        catch(PDOException $e)        {            echo $e->getMessage();        }    }		public function redirect($url){		header("Location: $url");	}    public function doLogin($umail,$upass){        try{            $stmt = $this->conn->prepare("SELECT profissionaiid, nome, cor, email, senha, admingrupo, adminempresa, empresas.empresaid, empresas.nomefantasia, empresas.nomefantasia as empresa, grupos.nomefantasia as grupo, grupos.grupoid, empresas.usacomissao, empresas.cidadeid, visao FROM profissionais, empresas, grupos WHERE profissionais.empresaid = empresas.empresaid AND empresas.grupoid = grupos.grupoid AND email=:umail AND profissionais.excluido = 'N' AND profissionais.bloqueado = 'N'");            $stmt->execute(array(':umail'=>$umail));            $userRow=$stmt->fetch(PDO::FETCH_ASSOC);            if($stmt->rowCount() == 1){                if(password_verify($upass, $userRow['senha'])){                    $_SESSION['user_session'] = $userRow['profissionaiid'];                    $_SESSION['nome'] = $userRow['nome'];                    $_SESSION['admingrupo'] = $userRow['admingrupo'];                    $_SESSION['adminempresa'] = $userRow['adminempresa'];                    $_SESSION['empresa'] = $userRow['empresa'];                    $_SESSION['empresaid'] = $userRow['empresaid'];                    $_SESSION['grupo'] = $userRow['grupo'];                    $_SESSION['grupoid'] = $userRow['grupoid'];                    $_SESSION['usacomissao'] = $userRow['usacomissao'];                    $_SESSION['cidadeid'] = $userRow['cidadeid'];                    $_SESSION['visao'] = $userRow['visao'];                    return true;                }                else{                    return false;                }            }        }        catch(PDOException $e){            echo $e->getMessage();        }    }    public function is_loggedin(){        if(isset($_SESSION['user_session'])) {            return true;        }    }    public function doLogout(){        session_destroy();        unset($_SESSION['user_session']);        unset($_SESSION['nome']);        unset($_SESSION['admingrupo']);        unset($_SESSION['adminempresa']);        unset($_SESSION['empresa']);        unset($_SESSION['empresaid']);        unset($_SESSION['grupo']);        unset($_SESSION['grupoid']);        unset($_SESSION['usacomissao']);        unset($_SESSION['cidadeid']);        unset($_SESSION['visao']);        return true;    }}?>