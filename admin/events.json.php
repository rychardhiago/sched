<?phpsession_name("login_sched"); session_start();date_default_timezone_set('America/Sao_Paulo');require_once('classes/class.agendamentos.php');$agendamento = new agendamentos();$start = $_REQUEST['from'] / 1000;$end   = $_REQUEST['to'] / 1000;$sql   = "SELECT agendamentos.agendamentoid, agendamentos.datainicio, agendamentos.datafim, agendamentos.obscli, agendamentos.obsemp, agendamentos.cancelado ";$sql  .= ", agendamentos.datacancel , agendamentos.interno, agendamentos.profausente, agendamentos.nomecliente, profissionais.cor, profissionais.nome ";$sql  .= "FROM agendamentos, profissionais, empresas ";$sql  .= "WHERE agendamentos.profissionaiid = profissionais.profissionaiid and agendamentos.empresaid = empresas.empresaid and agendamentos.cancelado = 'N' ";$sql  .= "and (datainicio BETWEEN '".date('Y-m-d H:i:s', $start)."' and '".date('Y-m-d H:i:s', $end)."' or datafim BETWEEN '".date('Y-m-d H:i:s', $start)."' and '".date('Y-m-d H:i:s', $end)."') ";$profissionaiid = $_SESSION['user_session'];if($_SESSION['adminempresa'] == 'S') {    if (isset($_REQUEST['profissionaiid']) && ($_REQUEST['profissionaiid'] > 0)) {        $profissionaiid = $_REQUEST['profissionaiid'];        $sql .= "and agendamentos.profissionaiid = " . $profissionaiid;    } else {        $sql .= " and empresas.empresaid = " . $_SESSION['empresaid'];    }}else{    $sql .= "and agendamentos.profissionaiid = " . $profissionaiid;}$sql .= " order by agendamentos.datainicio";//echo $sql;$stmt = $agendamento->runQuery($sql);$stmt->execute();$out = array();function removeSpecialChar($value){    $result  = preg_replace('/[^a-zA-Z0-9_ -]/s','',$value);    return $result;}$date0 = new DateTime(date('Y-m-d', $start));$filtroStart0 = $date0;$date1 = new DateTime(date('Y-m-d', $start));$filtroStart1 = $date1->modify('+1 day');$date2 = new DateTime(date('Y-m-d', $start));$filtroStart2 = $date2->modify('+1 day');$filtroStart2 = $date2->modify('+1 day');$date3 = new DateTime(date('Y-m-d', $start));$filtroStart3 = $date3->modify('+1 day');$filtroStart3 = $date3->modify('+1 day');$filtroStart3 = $date3->modify('+1 day');$date4 = new DateTime(date('Y-m-d', $start));$filtroStart4 = $date4->modify('+1 day');$filtroStart4 = $date4->modify('+1 day');$filtroStart4 = $date4->modify('+1 day');$filtroStart4 = $date4->modify('+1 day');$date5 = new DateTime(date('Y-m-d', $start));$filtroStart5 = $date5->modify('+1 day');$filtroStart5 = $date5->modify('+1 day');$filtroStart5 = $date5->modify('+1 day');$filtroStart5 = $date5->modify('+1 day');$filtroStart5 = $date5->modify('+1 day');$date6 = new DateTime(date('Y-m-d', $start));$filtroStart6 = $date6->modify('+1 day');$filtroStart6 = $date6->modify('+1 day');$filtroStart6 = $date6->modify('+1 day');$filtroStart6 = $date6->modify('+1 day');$filtroStart6 = $date6->modify('+1 day');$filtroStart6 = $date6->modify('+1 day');while($tipo = $stmt->fetch()) {    $class = "";//    if($tipo['cancelado'] == 'S'){ $class = "event-important"; }//    if($tipo['profausente'] == 'S'){ $class = "border-red"; }    $class .= ' '.removeSpecialChar(str_replace(' ','',$tipo['nome']));    $out[] = array(        'id' => $tipo['agendamentoid'],        'title' => $tipo['nomecliente'] ,        'start_hour' => date('H:i',strtotime($tipo['datainicio'])),        'end_hour' =>date('H:i',strtotime($tipo['datafim'])),		"class" => $class,        'url' => "agendamento.php?id=".$tipo['agendamentoid'],        'start' => strtotime($tipo['datainicio']) . '000',		'end' => strtotime($tipo['datafim']) . '000',        'startD' => $tipo['datainicio'],        'endD' => $tipo['datafim'],        'filtroStart0' => $filtroStart0,        'filtroStart1' => $filtroStart1,        'filtroStart2' => $filtroStart2,        'filtroStart3' => $filtroStart3,        'filtroStart4' => $filtroStart4,        'filtroStart5' => $filtroStart5,        'filtroStart6' => $filtroStart6    );}echo json_encode(array('success' => 1, 'result' => $out));exit;?>